(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e={start:['"',"'","`","{","["],end:['"',"'","`","}","]"]},i=t=>t[t.length-1],s=(t,e)=>{for(const i of e.childNodes)if(i.nodeType==Node.TEXT_NODE){if(i.length>=t){let e=document.createRange(),s=window.getSelection();return e.setStart(i,t),e.collapse(!0),s.removeAllRanges(),s.addRange(e),-1}t-=i.length}else if((t=s(t,i))<0)return t;return t},r="undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:void 0;class n{constructor(t,e=!1){return t instanceof Node&&(this.ln=e,this.wrap=t,this.scroller=document.createElement("DIV"),this.textarea=document.createElement("DIV"),(i=this.textarea).setAttribute("contenteditable",navigator.userAgent.toLowerCase().indexOf("firefox")>-1||"plaintext-only"),i.setAttribute("spellcheck",!1),i.classList.add("tar-textarea"),i.style.whiteSpace="pre",i.style.wordWrap="normal",i.style.overflowY="hidden",i.style.padding="6px",i.style.outline="0px solid transparent",i.style.flex=1,this.prev=this.textarea.textContent,this.timeMachine=[{html:"",pos:0}],this.at=0,this.editor={on:(t,e)=>{this.textarea.addEventListener(t,e)},innerHTML:()=>this.textarea.innerHTML,textContent:()=>this.textarea.textContent,diff:t=>{"function"==typeof t&&this.prev!==this.editor.textContent()&&t()},refresh:()=>{this.prev=this.editor.textContent()},before:()=>(t=>{const e=window.getSelection().getRangeAt(0),i=document.createRange();return i.selectNodeContents(t),i.setEnd(e.startContainer,e.startOffset),i.toString()})(this.textarea),after:()=>(t=>{const e=window.getSelection().getRangeAt(0),i=document.createRange();return i.selectNodeContents(t),i.setStart(e.endContainer,e.endOffset),i.toString()})(this.textarea),save:()=>this.editor.before().length,restore:t=>s(t,this.textarea),insert:(t="")=>{const e=this.editor.before()+t+this.editor.after(),i=this.editor.save();this.textarea.textContent=e,this.editor.restore(i+t.length)},setHTML:(t="")=>{this.textarea.innerHTML=t}},this.editor.on("keydown",(t=>{if(this.editor.refresh(),this.indent(t),this.enter(t),this.autoComplete(t),this.setVer(t),this.delete(t),this.lineNumbers){this.lineNumbers.innerHTML="1<br>";const t=this.editor.textContent().split(/\n(?!$)/g).length;for(let e=2;e<t;e++)this.lineNumbers.innerHTML+=String(e)+"<br>"}})),this.editor.on("keyup",(t=>{this.editor.diff((()=>{if(this.lineNumbers){this.lineNumbers.innerHTML="1<br>";const t=this.editor.textContent().split(/\n(?!$)/g).length;for(let e=1;e<t;e++)this.lineNumbers.innerHTML+=String(e+1)+"<br>"}const t=this.editor.save(),e=this.editor.textContent().replace(/</g,"&lt;");this.editor.setHTML(e),this.editor.restore(t),this.editor.innerHTML().split("\n"),window.setTimeout((()=>{if(this.timeMachine[this.at].html===this.editor.innerHTML())return;this.at++;const t=this.editor.innerHTML(),e=this.editor.save();this.timeMachine.push({html:t,pos:e})}),300)}))})),(r=this.scroller).style.flex=1,r.classList.add("tar-scroller"),r.style.overflow="auto",r.style.display="flex",r.style.alignItems="flex-start",(t=>{t.classList.add("tar-wrap"),t.style.display="flex",t.style.flexDirection="column",t.style.overflow="hidden"})(this.wrap),!0===this.ln&&(this.lineNumbers=document.createElement("DIV"),(n=this.lineNumbers).style.width="3%",n.innerHTML="1<br>",n.style.paddingTop="6px",n.style.textAlign="center",this.textarea.style.flex="97%",this.scroller.appendChild(this.lineNumbers)),this.scroller.appendChild(this.textarea),this.wrap.appendChild(this.scroller),this);var i,r,n}indent(t){if("Tab"===t.key){if(t.preventDefault(),t.shiftKey);else{const t=String(window.getSelection());this.editor.insert("\t"+t);const e=this.editor.save();this.editor.restore(e-t.length)}return!0}return!1}enter(t){if("Enter"===t.key){const e=i(this.editor.before().split("\n"));let s="",r=0;for(;"\t"===e.charAt(r);)s+="\t",r++;if(e.endsWith("{")&&this.editor.after().startsWith("}")){t.preventDefault(),this.editor.insert("\n"+s+"\t");const e=this.editor.save();this.editor.insert("\n"+s),this.editor.restore(e)}else s.length>0&&(t.preventDefault(),this.editor.insert("\n"+s));if(this.lineNumbers){const t=String(Number(this.lineNumbers.innerHTML.split("<br>")[this.lineNumbers.innerHTML.split("<br>").length-2])+1)+"<br>";this.lineNumbers.innerHTML+=t}return!0}return!1}autoComplete(t){for(let i=0;i<e.start.length;i++){if(t.key===e.start[i]){if(t.preventDefault(),e.start[i]===e.end[i]&&this.editor.before().endsWith(e.start[i])&&this.editor.after().startsWith(e.end[i])){const t=this.editor.save()+1;this.editor.restore(t)}else{this.editor.insert(e.start[i]+e.end[i]);const t=this.editor.save()-1;this.editor.restore(t)}break}if(t.key===e.end[i]){if(this.editor.before().endsWith(e.start[i])&&this.editor.after().startsWith(e.end[i])){t.preventDefault();const e=this.editor.save()+1;this.editor.restore(e)}break}}}setVer(t){return t.shiftKey||!t.ctrlKey&&!t.metaKey||"z"!==t.key?!(!t.shiftKey||!t.ctrlKey&&!t.metaKey||"z"!==t.key||(t.preventDefault(),this.at++,this.at>=this.timeMachine.length?this.at=this.timeMachine.length-1:(this.editor.setHTML(this.timeMachine[this.at].html),this.editor.restore(this.timeMachine[this.at].pos)),0)):(t.preventDefault(),this.at--,this.at<0?this.at=0:(this.editor.setHTML(this.timeMachine[this.at].html),this.editor.restore(this.timeMachine[this.at].pos)),!0)}delete(t){if("Backspace"===t.key){if(i(this.editor.innerHTML().split("\n")),this.lineNumbers){this.lineNumbers.innerHTML="1<br>";const t=this.editor.textContent().split(/\n(?!$)/g).length;for(let e=2;e<t;e++)this.lineNumbers.innerHTML+=String(e)+"<br>"}return!0}return!1}}const o={init:(t,e)=>new n(t,e)};r.tar=o})();