(()=>{"use strict";var t={d:(e,i)=>{for(var r in i)t.o(i,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var e={};t.r(e),t.d(e,{afterCursor:()=>o,beforeCursor:()=>n,initScroller:()=>a,initTextarea:()=>l,initWrap:()=>h,lastOf:()=>r,restoreCaretPosition:()=>s,specialChars:()=>i});const i={start:['"',"'","`","{","["],end:['"',"'","`","}","]"]},r=t=>t[t.length-1],s=(t,e)=>{for(const i of e.childNodes)if(i.nodeType==Node.TEXT_NODE){if(i.length>=t){let e=document.createRange(),r=window.getSelection();return e.setStart(i,t),e.collapse(!0),r.removeAllRanges(),r.addRange(e),-1}t-=i.length}else if((t=s(t,i))<0)return t;return t},n=t=>{const e=window.getSelection().getRangeAt(0),i=document.createRange();return i.selectNodeContents(t),i.setEnd(e.startContainer,e.startOffset),i.toString()},o=t=>{const e=window.getSelection().getRangeAt(0),i=document.createRange();return i.selectNodeContents(t),i.setStart(e.endContainer,e.endOffset),i.toString()},h=t=>{t.classList.add("tar-wrap"),t.style.display="flex",t.style.flexDirection="column",t.style.overflow="hidden"},a=t=>{t.style.flex=1,t.classList.add("tar-scroller"),t.style.overflow="auto",t.style.display="flex",t.style.alignItems="flex-start"},l=t=>{t.setAttribute("contenteditable",navigator.userAgent.toLowerCase().indexOf("firefox")>-1||"plaintext-only"),t.setAttribute("spellcheck",!1),t.classList.add("tar-textarea"),t.style.whiteSpace="pre",t.style.wordWrap="normal",t.style.overflowY="hidden",t.style.padding="6px",t.style.outline="0px solid transparent",t.style.flex=1};console.log(e);const d="undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:void 0;class f{constructor(t){return t instanceof Node&&(this.ln=!1,this.wrap=t,this.scroller=document.createElement("DIV"),this.textarea=document.createElement("DIV"),l(this.textarea),this.prev=this.textarea.textContent,this.timeMachine=[{html:"",pos:0}],this.at=0,this.editor={on:(t,e)=>{this.textarea.addEventListener(t,e)},innerHTML:()=>this.textarea.innerHTML,textContent:()=>this.textarea.textContent,diff:t=>{"function"==typeof t&&this.prev!==this.editor.textContent()&&t()},refresh:()=>{this.prev=this.editor.textContent()},before:()=>n(this.textarea),after:()=>o(this.textarea),save:()=>this.editor.before().length,restore:t=>s(t,this.textarea),insert:(t="")=>{const e=this.editor.before()+t+this.editor.after(),i=this.editor.save();this.textarea.textContent=e,this.editor.restore(i+t.length)},setHTML:(t="")=>{this.textarea.innerHTML=t}},this.editor.on("keydown",(t=>{this.editor.refresh(),this.indent(t),this.enter(t),this.autoComplete(t),this.setVer(t),this.delete(t)})),this.editor.on("keyup",(t=>{this.editor.diff((()=>{if(this.lineNumbers){this.lineNumbers.innerHTML="1<br>";const t=this.editor.textContent().split(/\n(?!$)/g).length;for(let e=1;e<t;e++)this.lineNumbers.innerHTML+=String(e+1)+"<br>"}const t=this.editor.save(),e=this.editor.textContent().replace(/</g,"&lt;");this.editor.setHTML(e),this.editor.restore(t),this.editor.innerHTML().split("\n"),window.setTimeout((()=>{if(this.timeMachine[this.at].html===this.editor.innerHTML())return;this.at++;const t=this.editor.innerHTML(),e=this.editor.save();this.timeMachine.push({html:t,pos:e})}),300)}))})),a(this.scroller),h(this.wrap),this.scroller.appendChild(this.textarea),this.wrap.appendChild(this.scroller),this)}setLN(t){return this.ln=!0,this.lineNumbers=document.createElement("DIV"),this.lineNumbers.style.width="3%",this.textarea.style.flex="97%",this.scroller.insertBefore(this.lineNumbers,this.textarea),this.lineNumbers.innerHTML="1<br>",this.lineNumbers.style.paddingTop="6px",this.lineNumbers.style.textAlign="center",this}indent(t){if("Tab"===t.key){if(t.preventDefault(),t.shiftKey);else{const t=String(window.getSelection());this.editor.insert("\t"+t);const e=this.editor.save();this.editor.restore(e-t.length)}return!0}return!1}enter(t){if("Enter"===t.key){const e=r(this.editor.before().split("\n"));let i="",s=0;for(;"\t"===e.charAt(s);)i+="\t",s++;if(e.endsWith("{")&&this.editor.after().startsWith("}")){t.preventDefault(),this.editor.insert("\n"+i+"\t");const e=this.editor.save();this.editor.insert("\n"+i),this.editor.restore(e)}else i.length>0&&(t.preventDefault(),this.editor.insert("\n"+i));if(this.lineNumbers){const t=String(Number(this.lineNumbers.innerHTML.split("<br>")[this.lineNumbers.innerHTML.split("<br>").length-2])+1)+"<br>";this.lineNumbers.innerHTML+=t}return!0}return!1}autoComplete(t){for(let e=0;e<i.start.length;e++){if(t.key===i.start[e]){if(t.preventDefault(),i.start[e]===i.end[e]&&this.editor.before().endsWith(i.start[e])&&this.editor.after().startsWith(i.end[e])){const t=this.editor.save()+1;this.editor.restore(t)}else{this.editor.insert(i.start[e]+i.end[e]);const t=this.editor.save()-1;this.editor.restore(t)}break}if(t.key===i.end[e]){if(this.editor.before().endsWith(i.start[e])&&this.editor.after().startsWith(i.end[e])){t.preventDefault();const e=this.editor.save()+1;this.editor.restore(e)}break}}}setVer(t){return t.shiftKey||!t.ctrlKey&&!t.metaKey||"z"!==t.key?!(!t.shiftKey||!t.ctrlKey&&!t.metaKey||"z"!==t.key||(t.preventDefault(),this.at++,this.at>=this.timeMachine.length?this.at=this.timeMachine.length-1:(this.editor.setHTML(this.timeMachine[this.at].html),this.editor.restore(this.timeMachine[this.at].pos)),0)):(t.preventDefault(),this.at--,this.at<0?this.at=0:(this.editor.setHTML(this.timeMachine[this.at].html),this.editor.restore(this.timeMachine[this.at].pos)),!0)}delete(t){if("Backspace"===t.key){if(r(this.editor.innerHTML().split("\n")),this.lineNumbers){this.lineNumbers.innerHTML="1<br>";const t=this.editor.textContent().split(/\n(?!$)/g).length;for(let e=2;e<t;e++)this.lineNumbers.innerHTML+=String(e)+"<br>"}return!0}return!1}}d.tar=t=>new f(t)})();